<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××™×™×¢×¥ ××™××•× ×™ ×›×“×•×¨×’×œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
        }

        body[dir="rtl"] {
            text-align: right;
        }

        body[dir="ltr"] {
            text-align: left;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .lang-switcher {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
        }

        body[dir="rtl"] .lang-switcher {
            right: auto;
            left: 15px;
        }

        .lang-switcher:hover {
            background: rgba(255,255,255,0.3);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .section {
            padding: 20px;
            display: none;
        }

        .section.active {
            display: block;
        }

        .instruction-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #856404;
        }

        .selected-role-display {
            background: #d4edda;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
            color: #155724;
            display: none;
        }

        .selected-role-display.show {
            display: block;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 24px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            font-weight: 600;
            transition: all 0.3s;
            touch-action: manipulation;
        }

        .btn:active {
            transform: scale(0.97);
            opacity: 0.9;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-success {
            background: #28a745;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .role-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .role-btn {
            padding: 15px 8px;
            background: #f8f9fa;
            border: 3px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
            touch-action: manipulation;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .role-btn:active {
            transform: scale(0.95);
        }

        .role-btn.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transform: scale(1.05);
        }

        .drill-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
        }

        body[dir="rtl"] .drill-card {
            border-left: none;
            border-right: 5px solid #667eea;
        }

        .drill-card.white {
            border-color: #28a745;
            background: #f1f9f3;
        }

        .drill-card.mixed {
            border-color: #ffc107;
            background: #fffbf0;
        }

        .drill-card.gray {
            border-color: #6c757d;
            background: #f5f5f5;
        }

        .drill-card.category-attack {
            border-top: 4px solid #dc3545;
        }

        .drill-card.category-defense {
            border-top: 4px solid #28a745;
        }

        .drill-card.category-physical {
            border-top: 4px solid #6f42c1;
        }

        .drill-card.category-possession {
            border-top: 4px solid #fd7e14;
        }

        .drill-card h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .drill-stats {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .drill-attrs {
            font-size: 13px;
            color: #555;
            line-height: 1.6;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 5px;
        }

        body[dir="rtl"] .badge {
            margin-right: 0;
            margin-left: 5px;
        }

        .badge-difficulty {
            background: #667eea;
            color: white;
        }

        .badge-category {
            font-size: 11px;
            padding: 3px 7px;
        }

        .badge-attack {
            background: #dc3545;
            color: white;
        }

        .badge-defense {
            background: #28a745;
            color: white;
        }

        .badge-physical {
            background: #6f42c1;
            color: white;
        }

        .badge-possession {
            background: #fd7e14;
            color: white;
        }

        .priority-header {
            background: #667eea;
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .priority-header.white {
            background: #28a745;
        }

        .priority-header.mixed {
            background: #ffc107;
            color: #333;
        }

        .priority-header.gray {
            background: #6c757d;
        }

        .attr-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .summary-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .summary-box h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #667eea;
        }

        .category-legend {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .attributes-display {
            margin-bottom: 20px;
        }

        .attributes-display h4 {
            font-size: 14px;
            color: #667eea;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .attr-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .attr-item.white {
            background: #f1f9f3;
            border-left: 3px solid #28a745;
        }

        body[dir="rtl"] .attr-item.white {
            border-left: none;
            border-right: 3px solid #28a745;
        }

        .attr-item.gray {
            background: #f5f5f5;
            border-left: 3px solid #6c757d;
        }

        body[dir="rtl"] .attr-item.gray {
            border-left: none;
            border-right: 3px solid #6c757d;
        }

        .no-drills {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        @media (max-width: 600px) {
            .attr-grid {
                grid-template-columns: 1fr;
            }

            .role-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body dir="rtl">
    <div class="container">
        <div class="header">
            <button class="lang-switcher" onclick="toggleLanguage()">English</button>
            <h1 id="headerTitle">âš½ ××™×™×¢×¥ ××™××•× ×™ ×›×“×•×¨×’×œ</h1>
            <p id="headerSubtitle">××¦× ××ª ×”×ª×¨×’×™×œ×™× ×”×˜×•×‘×™× ×‘×™×•×ª×¨ ×œ×©×—×§×Ÿ ×©×œ×š</p>
        </div>

        <!-- Role Selection Section -->
        <div id="roleSection" class="section active">
            <h2 style="margin-bottom: 15px;" id="roleTitle">×‘×—×¨ ×ª×¤×§×™×“ ×©×—×§×Ÿ</h2>
            <div class="instruction-box">
                <span id="roleInstruction">ğŸ‘† <strong>×©×œ×‘ 1:</strong> ×œ×—×¥ ×¢×œ ×ª×¤×§×™×“ ×›×“×™ ×œ×‘×—×•×¨ ××•×ª×•</span>
            </div>
            <div class="selected-role-display" id="selectedRoleBox">
                <span id="selectedPrefix">âœ“ × ×‘×—×¨:</span> <span id="selectedRoleText"></span>
            </div>
            <div id="roleGrid" class="role-grid"></div>
            <button class="btn" onclick="continueToAttributes()"><span id="continueBtn">×”××©×š â†</span></button>
        </div>

        <!-- Attributes Input Section -->
        <div id="attributesSection" class="section">
            <h2 style="margin-bottom: 15px;" id="attrTitle">×”×–×Ÿ ×××¤×™×™× ×™ ×©×—×§×Ÿ</h2>
            <p style="margin-bottom: 20px; color: #666;"><span id="roleLabel">×ª×¤×§×™×“:</span> <strong id="selectedRoleName"></strong></p>
            <div class="instruction-box">
                <span id="attrInstruction">â­ = ×××¤×™×™× ×™× ×—×©×•×‘×™× (×œ×‘×Ÿ) ×œ×ª×¤×§×™×“ ×–×”</span>
            </div>
            <div id="attributesForm"></div>
            <button class="btn" onclick="calculateRecommendations()"><span id="getRecsBtn">×§×‘×œ ×”××œ×¦×•×ª âš¡</span></button>
            <button class="btn btn-secondary" onclick="backToRoles()"><span id="backBtn1">â†’ ×—×–×•×¨</span></button>
        </div>

        <!-- Recommendations Section -->
        <div id="recommendationsSection" class="section">
            <h2 style="margin-bottom: 15px;" id="recsTitle">×”××œ×¦×•×ª ××™××•×Ÿ</h2>
            <p style="margin-bottom: 20px; color: #666;"><span id="roleLabel2">×ª×¤×§×™×“:</span> <strong id="recRoleName"></strong></p>

            <div class="summary-box" id="summaryBox"></div>

            <div id="recommendationsList"></div>

            <div class="action-buttons">
                <button class="btn btn-success" onclick="updateAttributes()"><span id="updateBtn">×¢×“×›×Ÿ ×××¤×™×™× ×™×</span></button>
                <button class="btn btn-secondary" onclick="viewAttributes()"><span id="viewBtn">×¦×¤×” ×‘×××¤×™×™× ×™×</span></button>
            </div>
            <button class="btn" onclick="backToRoles()" style="margin-top: 10px;"><span id="startOverBtn">â†’ ×”×ª×—×œ ××—×“×©</span></button>
        </div>

        <!-- View Attributes Section -->
        <div id="viewAttributesSection" class="section">
            <h2 style="margin-bottom: 15px;" id="viewAttrTitle">×××¤×™×™× ×™× × ×•×›×—×™×™×</h2>
            <p style="margin-bottom: 20px; color: #666;"><span id="roleLabel3">×ª×¤×§×™×“:</span> <strong id="viewRoleName"></strong></p>
            <div id="attributesDisplay"></div>
            <button class="btn" onclick="backToRecommendations()"><span id="backToRecsBtn">â†’ ×—×–×•×¨ ×œ×”××œ×¦×•×ª</span></button>
        </div>

        <!-- Update Attributes Section -->
        <div id="updateSection" class="section">
            <h2 style="margin-bottom: 15px;" id="updateAttrTitle">×¢×“×›×Ÿ ×××¤×™×™× ×™ ×©×—×§×Ÿ</h2>
            <div class="instruction-box">
                <span id="updateInstruction">×”×–×Ÿ ×¢×¨×›×™× ×—×“×©×™× ×œ××—×¨ ××™××•×Ÿ. ×”×©××¨ ×¨×™×§ ×›×“×™ ×œ×©××•×¨ ×¢×œ ×”×¢×¨×š ×”× ×•×›×—×™.</span>
            </div>
            <div id="updateForm"></div>
            <button class="btn btn-success" onclick="saveUpdates()"><span id="saveBtn">×©××•×¨ ×•×—×©×‘ ××—×“×© âš¡</span></button>
            <button class="btn btn-secondary" onclick="backToRecommendations()"><span id="cancelBtn">â†’ ×‘×˜×œ</span></button>
        </div>
    </div>

    <script>
        // Language state
        let currentLang = 'he';

        // Translations
        const translations = {
            he: {
                // Header
                headerTitle: 'âš½ ××™×™×¢×¥ ××™××•× ×™ ×›×“×•×¨×’×œ',
                headerSubtitle: '××¦× ××ª ×”×ª×¨×’×™×œ×™× ×”×˜×•×‘×™× ×‘×™×•×ª×¨ ×œ×©×—×§×Ÿ ×©×œ×š',

                // Role Selection
                roleTitle: '×‘×—×¨ ×ª×¤×§×™×“ ×©×—×§×Ÿ',
                roleInstruction: 'ğŸ‘† <strong>×©×œ×‘ 1:</strong> ×œ×—×¥ ×¢×œ ×ª×¤×§×™×“ ×›×“×™ ×œ×‘×—×•×¨ ××•×ª×•',
                selectedPrefix: 'âœ“ × ×‘×—×¨:',
                continueBtn: '×”××©×š â†',

                // Attributes Input
                attrTitle: '×”×–×Ÿ ×××¤×™×™× ×™ ×©×—×§×Ÿ',
                roleLabel: '×ª×¤×§×™×“:',
                attrInstruction: 'â­ = ×××¤×™×™× ×™× ×—×©×•×‘×™× (×œ×‘×Ÿ) ×œ×ª×¤×§×™×“ ×–×”',
                getRecsBtn: '×§×‘×œ ×”××œ×¦×•×ª âš¡',
                backBtn: 'â†’ ×—×–×•×¨',
                playerTierLabel: 'â­ ×“×¨×’×ª ×©×—×§×Ÿ',
                tierNote: 'ğŸ’¡ <strong>×”×¢×¨×”:</strong> ×”×–×Ÿ ××ª ×”×¢×¨×›×™× ×”×›×•×œ×œ×™× ×©××ª×” ×¨×•××” ×‘××©×—×§ (×”×›×•×œ×œ ××ª ×‘×•× ×•×¡ ×”×“×¨×’×”). ×‘×•× ×•×¡ ×”×“×¨×’×” ×™×•×¤×—×ª ××××¤×™×™× ×™× ×œ×‘× ×™× ×‘×¢×ª ×—×™×©×•×‘ ×™×¢×™×œ×•×ª ×ª×¨×’×™×œ (×¡×£ 180).',

                // Recommendations
                recsTitle: '×”××œ×¦×•×ª ××™××•×Ÿ',
                updateBtn: '×¢×“×›×Ÿ ×××¤×™×™× ×™×',
                viewBtn: '×¦×¤×” ×‘×××¤×™×™× ×™×',
                startOverBtn: 'â†’ ×”×ª×—×œ ××—×“×©',
                summary: '×¡×™×›×•×',
                playerTier: '×“×¨×’×ª ×©×—×§×Ÿ:',
                tierIncluded: '× ×›×œ×œ ×‘×××¤×™×™× ×™× ×œ×‘× ×™×',
                tierSubtracted: '×‘×•× ×•×¡ ×”×“×¨×’×” ××•×¤×—×ª ××”×—×™×©×•×‘ (×¢×¨×›×™ ×‘×¡×™×¡ ××©××©×™× ×œ×¡×£ 180)',
                effectiveDrills: '×ª×¨×’×™×œ×™× ×™×¢×™×œ×™×:',
                whiteOnly: '×œ×‘×Ÿ ×‘×œ×‘×“:',
                mixed: '××¢×•×¨×‘:',
                grayOnly: '××¤×•×¨ ×‘×œ×‘×“:',
                ineffective: '×œ× ×™×¢×™×œ:',
                priority1: 'â­ ×¢×“×™×¤×•×ª 1: ×××¤×™×™× ×™× ×œ×‘× ×™× ×‘×œ×‘×“',
                priority2: 'âš¡ ×¢×“×™×¤×•×ª 2: ××¢×•×¨×‘ (×œ×‘×Ÿ + ××¤×•×¨)',
                priority3: 'â—¾ ×¢×“×™×¤×•×ª 3: ×××¤×™×™× ×™× ××¤×•×¨×™× ×‘×œ×‘×“',
                noDrills: 'âœ“ ×›×œ ×”×ª×¨×’×™×œ×™× ×œ× ×™×¢×™×œ×™×!<br>×”×©×—×§×Ÿ ×××•××Ÿ ×××•×“.',

                // View Attributes
                viewAttrTitle: '×××¤×™×™× ×™× × ×•×›×—×™×™×',
                backToRecsBtn: 'â†’ ×—×–×•×¨ ×œ×”××œ×¦×•×ª',
                whitePrimary: 'â­ ×××¤×™×™× ×™× ×œ×‘× ×™× (×¢×™×§×¨×™×™×)',
                graySecondary: 'â—¾ ×××¤×™×™× ×™× ××¤×•×¨×™× (××©× ×™×™×)',
                bonusIncluded: '×‘×•× ×•×¡ × ×›×œ×œ ×‘×××¤×™×™× ×™× ×œ×‘× ×™×',
                base: '×‘×¡×™×¡',

                // Update Attributes
                updateAttrTitle: '×¢×“×›×Ÿ ×××¤×™×™× ×™ ×©×—×§×Ÿ',
                updateInstruction: '×”×–×Ÿ ×¢×¨×›×™× ×—×“×©×™× ×œ××—×¨ ××™××•×Ÿ. ×”×©××¨ ×¨×™×§ ×›×“×™ ×œ×©××•×¨ ×¢×œ ×”×¢×¨×š ×”× ×•×›×—×™.',
                saveBtn: '×©××•×¨ ×•×—×©×‘ ××—×“×© âš¡',
                cancelBtn: 'â†’ ×‘×˜×œ',

                // Drill stats
                whiteAvg: '×××•×¦×¢ ×œ×‘×Ÿ:',
                grayAvg: '×××•×¦×¢ ××¤×•×¨:',
                overall: '×›×œ×œ×™:',
                potential: '×¤×•×˜× ×¦×™××œ:',
                white: '×œ×‘×Ÿ:',
                gray: '××¤×•×¨:',
                trains: 'â†’',

                // Category names
                attack: '×”×ª×§×¤×”',
                defense: '×”×’× ×”',
                physical: '×’×•×¤× ×™ ×•×× ×˜×œ×™',
                possession: '×”×—×–×§×”',

                // Attributes
                attrs: {
                    'Tackling': '×ª×™×§×•×œ',
                    'Marking': '×¡×™××•×Ÿ',
                    'Positioning': '××™×§×•×',
                    'Heading': '× ×’×™×—×”',
                    'Bravery': '××•××¥',
                    'Passing': '××¡×™×¨×•×ª',
                    'Dribbling': '×›×“×¨×•×¨',
                    'Crossing': '×”×¨××•×ª',
                    'Shooting': '×‘×¢×™×˜×•×ª',
                    'Finishing': '×¡×™×•××ª',
                    'Fitness': '×›×•×©×¨',
                    'Strength': '×›×•×—',
                    'Aggression': '××’×¨×¡×™×‘×™×•×ª',
                    'Speed': '××”×™×¨×•×ª',
                    'Creativity': '×™×¦×™×¨×ª×™×•×ª',
                    'Reflexes': '×¨×¤×œ×§×¡×™×',
                    'Agility': '×–×¨×™×–×•×ª',
                    'Anticipation': '×™×›×•×œ×ª ×—×™×–×•×™',
                    'Rushing out': '×™×¦×™××”',
                    'Communication': '×ª×§×©×•×¨×ª',
                    'Throwing': '×–×¨×™×§×”',
                    'Kicking': '×‘×¢×™×˜×•×ª',
                    'Punching': '×—×‘×˜×”',
                    'Aerial reach': '×™×›×•×œ×ª ××•×•×™×¨×™×ª',
                    'Concentration': '×¨×™×›×•×–'
                },

                // Tiers
                tiers: {
                    'None': '×¨×™×§',
                    'Rare': '× ×“×™×¨',
                    'Elite': '×¦××¨×ª',
                    'Stellar': '××¦×˜×™×™×Ÿ',
                    'Master': '×××¡×˜×¨',
                    'Epic': '××“×™×¨',
                    'Legendary': '××’×“×™'
                },

                // Drills
                drills: {
                    '1-on-1 Finishing': '×¡×™×•××ª 1-×¢×œ-1',
                    'Pass, Go and Shoot!': '××¡×•×¨, ×”×ª×§×“× ×•×‘×¢×˜!',
                    'Set-Piece Delivery': '×‘×™×¦×•×¢ ××¦×‘ × ×™×™×—',
                    'Shooting Technique': '×˜×›× ×™×§×ª ×‘×¢×™×˜×” ×œ×©×¢×¨',
                    'Slalom Dribble': '×“×¨×™×‘×œ ×‘×¡×œ××œ×•×',
                    'Wing Play': '××©×—×§ ××’×¤×™×',
                    'Fast Counter-Attacks': '×”×ª×§×¤×•×ª-× ×’×“ ××”×™×¨×•×ª',
                    'Video Analysis': '× ×™×ª×•×— ×¡×¨×˜×•× ×™ ×•×™×“××•',
                    'Use Your Head': '×”×©×ª××© ×‘×¨××© ×©×œ×š',
                    'One Line of Defense': '×§×• ×”×’× ×” ××—×“',
                    'Stop the Attacker': '×¢×¦×•×¨ ××ª ×©×—×§×Ÿ ×”×”×ª×§×¤×”',
                    'Defending Crosses': '×”×’×‘×”×” ×œ×”×’× ×”',
                    'Press the Play': '×“×—×•×§ ××ª ×©×—×§× ×™ ×”×”×ª×§×¤×”',
                    'Goalkeeper Training': '××™××•×Ÿ ×©×•×¢×¨×™×',
                    'Warm-Up': '×—×™××•×',
                    'Stretch': '××ª×™×—×•×ª',
                    'Carioca with Ladders': '×¦×¢×“ ×ª×™×× ×™ ×¢× ×¡×•×œ×',
                    'Long Run': '×¨×™×¦×” ××¨×•×›×”',
                    'Shuttle Runs': '×¨×™×¦×ª ×”×œ×•×š ×•×©×•×‘',
                    'Hurdle Jumps': '×§×¤×™×¦×ª ××©×•×›×•×ª',
                    'Gym': '×—×“×¨ ×›×•×©×¨',
                    'Sprint': '×¡×¤×¨×™× ×˜',
                    'Ball Control': '×©×œ×™×˜×” ×‘×›×“×•×¨',
                    'Piggy in the Middle': '××—×“ ×‘×××¦×¢',
                    'First Touch Play': '××©×—×§ ×‘× ×’×™×¢×” ×¨××©×•× ×”',
                    'Rapid Side Switch': '×”×—×œ×¤×ª ×¦×“×“×™× ××”×™×¨×”',
                    'Stay in Lane': '×©××™×¨×” ×¢×œ ××¡×œ×•×œ',
                    'Contact Play': '××©×—×§ ××’×¢',
                    'Passes Before Shot': '××¡×™×¨×•×ª ×œ×¤× ×™ ×‘×¢×™×˜×” ×œ×©×¢×¨'
                }
            },
            en: {
                // Header
                headerTitle: 'âš½ Football Training Optimizer',
                headerSubtitle: 'Find the best drills for your player',

                // Role Selection
                roleTitle: 'Select Player Role',
                roleInstruction: 'ğŸ‘† <strong>Step 1:</strong> Tap a role below to select it',
                selectedPrefix: 'âœ“ Selected:',
                continueBtn: 'Continue â†’',

                // Attributes Input
                attrTitle: 'Enter Player Attributes',
                roleLabel: 'Role:',
                attrInstruction: 'â­ = Important (WHITE) attributes for this role',
                getRecsBtn: 'Get Recommendations âš¡',
                backBtn: 'â† Back',
                playerTierLabel: 'â­ Player Tier',
                tierNote: 'ğŸ’¡ <strong>Note:</strong> Enter the TOTAL values you see in the game (which includes the tier bonus). The tier bonus will be subtracted from WHITE attributes when calculating drill effectiveness (180 threshold).',

                // Recommendations
                recsTitle: 'Training Recommendations',
                updateBtn: 'Update Attributes',
                viewBtn: 'View Attributes',
                startOverBtn: 'â† Start Over',
                summary: 'Summary',
                playerTier: 'Player Tier:',
                tierIncluded: 'included in WHITE attributes',
                tierSubtracted: 'Tier bonus subtracted from calculation (base values used for 180 threshold)',
                effectiveDrills: 'Effective Drills:',
                whiteOnly: 'White-only:',
                mixed: 'Mixed:',
                grayOnly: 'Gray-only:',
                ineffective: 'Ineffective:',
                priority1: 'â­ Priority 1: WHITE Attributes Only',
                priority2: 'âš¡ Priority 2: Mixed (White + Gray)',
                priority3: 'â—¾ Priority 3: GRAY Attributes Only',
                noDrills: 'âœ“ All drills are ineffective!<br>Player is highly trained.',

                // View Attributes
                viewAttrTitle: 'Current Attributes',
                backToRecsBtn: 'â† Back to Recommendations',
                whitePrimary: 'â­ WHITE (Primary) Attributes',
                graySecondary: 'â—¾ GRAY (Secondary) Attributes',
                bonusIncluded: 'bonus included in WHITE attributes',
                base: 'base',

                // Update Attributes
                updateAttrTitle: 'Update Player Attributes',
                updateInstruction: 'Enter new values after training. Leave blank to keep current value.',
                saveBtn: 'Save & Recalculate âš¡',
                cancelBtn: 'â† Cancel',

                // Drill stats
                whiteAvg: 'White Avg:',
                grayAvg: 'Gray Avg:',
                overall: 'Overall:',
                potential: 'Potential:',
                white: 'WHITE:',
                gray: 'GRAY:',
                trains: 'â†’',

                // Category names
                attack: 'Attack',
                defense: 'Defense',
                physical: 'Physical & Mental',
                possession: 'Possession',

                // Attributes (English names)
                attrs: {
                    'Tackling': 'Tackling',
                    'Marking': 'Marking',
                    'Positioning': 'Positioning',
                    'Heading': 'Heading',
                    'Bravery': 'Bravery',
                    'Passing': 'Passing',
                    'Dribbling': 'Dribbling',
                    'Crossing': 'Crossing',
                    'Shooting': 'Shooting',
                    'Finishing': 'Finishing',
                    'Fitness': 'Fitness',
                    'Strength': 'Strength',
                    'Aggression': 'Aggression',
                    'Speed': 'Speed',
                    'Creativity': 'Creativity',
                    'Reflexes': 'Reflexes',
                    'Agility': 'Agility',
                    'Anticipation': 'Anticipation',
                    'Rushing out': 'Rushing out',
                    'Communication': 'Communication',
                    'Throwing': 'Throwing',
                    'Kicking': 'Kicking',
                    'Punching': 'Punching',
                    'Aerial reach': 'Aerial reach',
                    'Concentration': 'Concentration'
                },

                // Tiers (English names)
                tiers: {
                    'None': 'None',
                    'Rare': 'Rare',
                    'Elite': 'Elite',
                    'Stellar': 'Stellar',
                    'Master': 'Master',
                    'Epic': 'Epic',
                    'Legendary': 'Legendary'
                },

                // Drills (English names)
                drills: {
                    '1-on-1 Finishing': '1-on-1 Finishing',
                    'Pass, Go and Shoot!': 'Pass, Go and Shoot!',
                    'Set-Piece Delivery': 'Set-Piece Delivery',
                    'Shooting Technique': 'Shooting Technique',
                    'Slalom Dribble': 'Slalom Dribble',
                    'Wing Play': 'Wing Play',
                    'Fast Counter-Attacks': 'Fast Counter-Attacks',
                    'Video Analysis': 'Video Analysis',
                    'Use Your Head': 'Use Your Head',
                    'One Line of Defense': 'One Line of Defense',
                    'Stop the Attacker': 'Stop the Attacker',
                    'Defending Crosses': 'Defending Crosses',
                    'Press the Play': 'Press the Play',
                    'Goalkeeper Training': 'Goalkeeper Training',
                    'Warm-Up': 'Warm-Up',
                    'Stretch': 'Stretch',
                    'Carioca with Ladders': 'Carioca with Ladders',
                    'Long Run': 'Long Run',
                    'Shuttle Runs': 'Shuttle Runs',
                    'Hurdle Jumps': 'Hurdle Jumps',
                    'Gym': 'Gym',
                    'Sprint': 'Sprint',
                    'Ball Control': 'Ball Control',
                    'Piggy in the Middle': 'Piggy in the Middle',
                    'First Touch Play': 'First Touch Play',
                    'Rapid Side Switch': 'Rapid Side Switch',
                    'Stay in Lane': 'Stay in Lane',
                    'Contact Play': 'Contact Play',
                    'Passes Before Shot': 'Passes Before Shot'
                }
            }
        };

        function t(key) {
            const keys = key.split('.');
            let value = translations[currentLang];
            for (let k of keys) {
                value = value[k];
                if (!value) return key;
            }
            return value;
        }

        function toggleLanguage() {
            currentLang = currentLang === 'he' ? 'en' : 'he';
            document.documentElement.lang = currentLang;
            document.body.dir = currentLang === 'he' ? 'rtl' : 'ltr';
            document.querySelector('.lang-switcher').textContent = currentLang === 'he' ? 'English' : '×¢×‘×¨×™×ª';
            document.title = currentLang === 'he' ? '××™×™×¢×¥ ××™××•× ×™ ×›×“×•×¨×’×œ' : 'Football Training Optimizer';
            updateUILanguage();
        }

        function updateUILanguage() {
            // Update all static text elements
            document.getElementById('headerTitle').textContent = t('headerTitle');
            document.getElementById('headerSubtitle').textContent = t('headerSubtitle');
            document.getElementById('roleTitle').textContent = t('roleTitle');
            document.getElementById('roleInstruction').innerHTML = t('roleInstruction');
            document.getElementById('selectedPrefix').textContent = t('selectedPrefix');
            document.getElementById('continueBtn').textContent = t('continueBtn');
            document.getElementById('attrTitle').textContent = t('attrTitle');
            document.getElementById('roleLabel').textContent = t('roleLabel');
            document.getElementById('attrInstruction').textContent = t('attrInstruction');
            document.getElementById('getRecsBtn').textContent = t('getRecsBtn');
            document.getElementById('backBtn1').textContent = t('backBtn');
            document.getElementById('recsTitle').textContent = t('recsTitle');
            document.getElementById('roleLabel2').textContent = t('roleLabel');
            document.getElementById('updateBtn').textContent = t('updateBtn');
            document.getElementById('viewBtn').textContent = t('viewBtn');
            document.getElementById('startOverBtn').textContent = t('startOverBtn');
            document.getElementById('viewAttrTitle').textContent = t('viewAttrTitle');
            document.getElementById('roleLabel3').textContent = t('roleLabel');
            document.getElementById('backToRecsBtn').textContent = t('backToRecsBtn');
            document.getElementById('updateAttrTitle').textContent = t('updateAttrTitle');
            document.getElementById('updateInstruction').textContent = t('updateInstruction');
            document.getElementById('saveBtn').textContent = t('saveBtn');
            document.getElementById('cancelBtn').textContent = t('cancelBtn');

            // Re-render current section content if needed
            if (selectedRole) {
                document.getElementById('selectedRoleName').textContent = selectedRole;
                document.getElementById('recRoleName').textContent = selectedRole;
                document.getElementById('viewRoleName').textContent = selectedRole;
            }
        }

        // Game data
        const REGULAR_ATTRIBUTES = [
            "Tackling", "Marking", "Positioning", "Heading", "Bravery",
            "Passing", "Dribbling", "Crossing", "Shooting", "Finishing",
            "Fitness", "Strength", "Aggression", "Speed", "Creativity"
        ];

        const GK_ATTRIBUTES = [
            "Reflexes", "Agility", "Anticipation", "Rushing out", "Communication",
            "Throwing", "Kicking", "Punching", "Aerial reach", "Concentration",
            "Fitness", "Strength", "Aggression", "Speed", "Creativity"
        ];

        const ROLE_WHITES = {
            "GK": ["Reflexes", "Agility", "Anticipation", "Rushing out", "Communication", "Throwing", "Kicking", "Punching", "Aerial reach", "Concentration", "Fitness"],
            "DL": ["Tackling", "Marking", "Positioning", "Bravery", "Crossing", "Fitness", "Aggression", "Speed"],
            "DC": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Fitness", "Strength", "Aggression"],
            "DR": ["Tackling", "Marking", "Positioning", "Bravery", "Crossing", "Fitness", "Aggression", "Speed"],
            "DMC": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Fitness", "Strength", "Aggression", "Creativity"],
            "ML": ["Positioning", "Passing", "Dribbling", "Crossing", "Fitness", "Speed", "Creativity"],
            "MC": ["Tackling", "Marking", "Positioning", "Bravery", "Passing", "Dribbling", "Shooting", "Fitness", "Speed", "Creativity"],
            "MR": ["Positioning", "Passing", "Dribbling", "Crossing", "Fitness", "Speed", "Creativity"],
            "AML": ["Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Speed", "Creativity"],
            "AMC": ["Heading", "Passing", "Dribbling", "Shooting", "Finishing", "Fitness", "Speed", "Creativity"],
            "AMR": ["Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Speed", "Creativity"],
            "ST": ["Positioning", "Heading", "Passing", "Dribbling", "Shooting", "Finishing", "Strength", "Speed", "Creativity"],
            "DC + DL": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Crossing", "Fitness", "Strength", "Aggression", "Speed"],
            "DC + DR": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Crossing", "Fitness", "Strength", "Aggression", "Speed"],
            "DC + DMC": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Fitness", "Strength", "Aggression", "Creativity"],
            "DL + ML": ["Tackling", "Marking", "Positioning", "Bravery", "Passing", "Dribbling", "Crossing", "Fitness", "Aggression", "Speed", "Creativity"],
            "DR + MR": ["Tackling", "Marking", "Positioning", "Bravery", "Passing", "Dribbling", "Crossing", "Fitness", "Aggression", "Speed", "Creativity"],
            "DMC + MC": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Dribbling", "Shooting", "Fitness", "Strength", "Aggression", "Speed", "Creativity"],
            "MC + ML": ["Tackling", "Marking", "Positioning", "Bravery", "Passing", "Dribbling", "Crossing", "Shooting", "Fitness", "Speed", "Creativity"],
            "MC + MR": ["Tackling", "Marking", "Positioning", "Bravery", "Passing", "Dribbling", "Crossing", "Shooting", "Fitness", "Speed", "Creativity"],
            "MC + AMC": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Dribbling", "Shooting", "Finishing", "Fitness", "Speed", "Creativity"],
            "ML + AML": ["Positioning", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Speed", "Creativity"],
            "MR + AMR": ["Positioning", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Speed", "Creativity"],
            "AMC + AML": ["Heading", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Speed", "Creativity"],
            "AMC + AMR": ["Heading", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Speed", "Creativity"],
            "AMC + ST": ["Positioning", "Heading", "Passing", "Dribbling", "Shooting", "Finishing", "Fitness", "Strength", "Speed", "Creativity"],
            "AML + ST": ["Positioning", "Heading", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Strength", "Speed", "Creativity"],
            "AMR + ST": ["Positioning", "Heading", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Strength", "Speed", "Creativity"],
            "DL + DC + DR": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Crossing", "Fitness", "Strength", "Aggression", "Speed"],
            "DL + DC + DMC": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Crossing", "Fitness", "Strength", "Aggression", "Speed", "Creativity"],
            "DL + DC + ML": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Dribbling", "Crossing", "Fitness", "Strength", "Aggression", "Speed", "Creativity"],
            "DL + ML + AML": ["Tackling", "Marking", "Positioning", "Bravery", "Passing", "Crossing", "Shooting", "Finishing", "Fitness", "Aggression", "Speed", "Creativity"],
            "DR + DC + DMC": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Crossing", "Fitness", "Strength", "Aggression", "Speed", "Creativity"],
            "DR + DC + MR": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Dribbling", "Crossing", "Fitness", "Strength", "Aggression", "Speed", "Creativity"],
            "DR + MR + AMR": ["Tackling", "Marking", "Positioning", "Bravery", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Aggression", "Speed", "Creativity"],
            "DC + DL + DMC": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Crossing", "Fitness", "Strength", "Aggression", "Speed", "Creativity"],
            "DC + DR + DMC": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Crossing", "Fitness", "Strength", "Aggression", "Speed", "Creativity"],
            "DC + DMC + MC": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Dribbling", "Shooting", "Fitness", "Strength", "Aggression", "Speed", "Creativity"],
            "DMC + MC + ML": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Dribbling", "Crossing", "Shooting", "Fitness", "Strength", "Aggression", "Speed", "Creativity"],
            "DMC + MC + MR": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Dribbling", "Crossing", "Shooting", "Fitness", "Strength", "Aggression", "Speed", "Creativity"],
            "MC + ML + AML": ["Tackling", "Marking", "Positioning", "Bravery", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Speed", "Creativity"],
            "MC + MR + AMR": ["Tackling", "Marking", "Positioning", "Bravery", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Speed", "Creativity"],
            "MC + AML + AMC": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Speed", "Creativity"],
            "MC + AMC + AMR": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Speed", "Creativity"],
            "MC + AMC + ST": ["Tackling", "Marking", "Positioning", "Heading", "Bravery", "Passing", "Dribbling", "Shooting", "Finishing", "Fitness", "Strength", "Speed", "Creativity"],
            "ML + AML + AMC": ["Positioning", "Heading", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Speed", "Creativity"],
            "ML + AML + ST": ["Positioning", "Heading", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Strength", "Speed", "Creativity"],
            "MR + AMR + AMC": ["Positioning", "Heading", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Speed", "Creativity"],
            "MR + AMR + ST": ["Positioning", "Heading", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Strength", "Speed", "Creativity"],
            "AML + AMC + AMR": ["Heading", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Speed", "Creativity"],
            "AML + AMC + ST": ["Positioning", "Heading", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Strength", "Speed", "Creativity"],
            "AMR + AMC + ST": ["Positioning", "Heading", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Strength", "Speed", "Creativity"],
            "AML + ST + AMR": ["Positioning", "Heading", "Passing", "Dribbling", "Crossing", "Shooting", "Finishing", "Fitness", "Strength", "Speed", "Creativity"]
        };

        const DRILLS = [
            ["1-on-1 Finishing", ["Tackling", "Anticipation", "Finishing", "Dribbling", "Rushing out"], "EASY", "attack"],
            ["Pass, Go and Shoot!", ["Anticipation", "Speed", "Shooting", "Passing"], "EASY", "attack"],
            ["Set-Piece Delivery", ["Crossing", "Rushing out", "Heading", "Shooting", "Marking"], "MEDIUM", "attack"],
            ["Shooting Technique", ["Agility", "Reflexes", "Finishing", "Strength", "Shooting"], "MEDIUM", "attack"],
            ["Slalom Dribble", ["Speed", "Dribbling", "Fitness", "Passing"], "HARD", "attack"],
            ["Wing Play", ["Crossing", "Punching", "Finishing", "Heading", "Shooting"], "HARD", "attack"],
            ["Fast Counter-Attacks", ["Crossing", "Finishing", "Passing", "Creativity", "Communication"], "VERY HARD", "attack"],
            ["Video Analysis", ["Bravery", "Creativity", "Communication", "Positioning"], "VERY EASY", "defense"],
            ["Use Your Head", ["Creativity", "Passing", "Heading", "Positioning"], "EASY", "defense"],
            ["One Line of Defense", ["Concentration", "Communication", "Marking", "Positioning"], "MEDIUM", "defense"],
            ["Stop the Attacker", ["Tackling", "Bravery", "Dribbling", "Strength", "Marking"], "MEDIUM", "defense"],
            ["Defending Crosses", ["Crossing", "Bravery", "Heading", "Aerial reach", "Marking"], "MEDIUM", "defense"],
            ["Press the Play", ["Tackling", "Bravery", "Positioning", "Aggression", "Marking"], "HARD", "defense"],
            ["Goalkeeper Training", ["Kicking", "Agility", "Reflexes", "Throwing", "Aerial reach"], "HARD", "defense"],
            ["Warm-Up", ["Fitness", "Reflexes", "Heading", "Aggression"], "VERY EASY", "physical"],
            ["Stretch", ["Speed", "Agility", "Fitness", "Strength"], "EASY", "physical"],
            ["Carioca with Ladders", ["Speed", "Agility", "Concentration", "Aggression"], "EASY", "physical"],
            ["Long Run", ["Fitness", "Speed", "Concentration"], "MEDIUM", "physical"],
            ["Shuttle Runs", ["Speed", "Bravery", "Agility", "Strength"], "HARD", "physical"],
            ["Hurdle Jumps", ["Speed", "Bravery", "Kicking", "Aggression"], "HARD", "physical"],
            ["Gym", ["Fitness", "Kicking", "Throwing", "Strength"], "VERY HARD", "physical"],
            ["Sprint", ["Speed", "Dribbling", "Fitness", "Rushing out"], "VERY HARD", "physical"],
            ["Ball Control", ["Dribbling", "Creativity", "Concentration", "Heading"], "VERY EASY", "possession"],
            ["Piggy in the Middle", ["Tackling", "Fitness", "Positioning", "Passing", "Aggression"], "EASY", "possession"],
            ["First Touch Play", ["Dribbling", "Fitness", "Passing", "Throwing"], "EASY", "possession"],
            ["Rapid Side Switch", ["Positioning", "Creativity", "Communication", "Crossing", "Passing", "Speed"], "MEDIUM", "possession"],
            ["Stay in Lane", ["Speed", "Fitness", "Aerial reach", "Positioning"], "MEDIUM", "possession"],
            ["Contact Play", ["Bravery", "Dribbling", "Strength", "Aggression", "Marking"], "MEDIUM", "possession"],
            ["Passes Before Shot", ["Anticipation", "Finishing", "Positioning", "Passing", "Creativity"], "HARD", "possession"]
        ];

        const PLAYER_TIERS = {
            "None": 0,
            "Rare": 10,
            "Elite": 30,
            "Stellar": 50,
            "Master": 80,
            "Epic": 120,
            "Legendary": 160
        };

        const EFFECTIVENESS_THRESHOLD = 180;

        let selectedRole = null;
        let playerStats = {};
        let playerTier = "None";

        function initRoleGrid() {
            const roleGrid = document.getElementById('roleGrid');
            const roles = Object.keys(ROLE_WHITES);

            roles.forEach(role => {
                const btn = document.createElement('div');
                btn.className = 'role-btn';
                btn.textContent = role;
                btn.onclick = () => selectRole(role);
                roleGrid.appendChild(btn);
            });
        }

        function selectRole(role) {
            selectedRole = role;

            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent === role) {
                    btn.classList.add('selected');
                }
            });

            document.getElementById('selectedRoleBox').classList.add('show');
            document.getElementById('selectedRoleText').textContent = role;
        }

        function continueToAttributes() {
            if (!selectedRole) {
                alert(currentLang === 'he' ? 'âš ï¸ ×× × ×‘×—×¨ ×ª×¤×§×™×“ ×ª×—×™×œ×”!\n\n×œ×—×¥ ×¢×œ ××—×“ ××›×¤×ª×•×¨×™ ×”×ª×¤×§×™×“ (×›××• ST, GK, DC ×•×›×•\') ×›×“×™ ×œ×‘×—×•×¨ ××•×ª×•.' : 'âš ï¸ Please select a role first!\n\nTap on one of the role buttons (like ST, GK, DC, etc.) to select it.');
                return;
            }

            showSection('attributesSection');
            document.getElementById('selectedRoleName').textContent = selectedRole;
            initAttributesForm();
        }

        function initAttributesForm() {
            const form = document.getElementById('attributesForm');
            const attributes = selectedRole === 'GK' ? GK_ATTRIBUTES : REGULAR_ATTRIBUTES;
            const whiteAttrs = new Set(ROLE_WHITES[selectedRole]);

            form.innerHTML = '';

            const tierGroup = document.createElement('div');
            tierGroup.style.marginBottom = '20px';
            tierGroup.innerHTML = `
                <div class="form-group">
                    <label style="font-size: 16px; color: #667eea;">${t('playerTierLabel')}</label>
                    <select id="playerTier" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
                        ${Object.keys(PLAYER_TIERS).map(tier =>
                            `<option value="${tier}" ${tier === playerTier ? 'selected' : ''}>${t('tiers.' + tier)} (+${PLAYER_TIERS[tier]})</option>`
                        ).join('')}
                    </select>
                </div>
            `;
            form.appendChild(tierGroup);

            const grid = document.createElement('div');
            grid.className = 'attr-grid';

            attributes.forEach(attr => {
                const isWhite = whiteAttrs.has(attr);
                const formGroup = document.createElement('div');
                formGroup.className = 'form-group';
                formGroup.innerHTML = `
                    <label>${t('attrs.' + attr)} ${isWhite ? 'â­' : ''}</label>
                    <input type="number" id="attr_${attr}" min="0" value="${playerStats[attr] || ''}" required>
                `;
                grid.appendChild(formGroup);
            });

            form.appendChild(grid);

            const infoBox = document.createElement('div');
            infoBox.style.background = '#e7f3ff';
            infoBox.style.border = '2px solid #2196F3';
            infoBox.style.borderRadius = '8px';
            infoBox.style.padding = '12px';
            infoBox.style.marginTop = '15px';
            infoBox.style.fontSize = '13px';
            infoBox.style.color = '#0d47a1';
            infoBox.innerHTML = t('tierNote');
            form.appendChild(infoBox);
        }

        function calculateRecommendations() {
            const attributes = selectedRole === 'GK' ? GK_ATTRIBUTES : REGULAR_ATTRIBUTES;
            let hasError = false;

            playerTier = document.getElementById('playerTier').value;

            attributes.forEach(attr => {
                const value = parseInt(document.getElementById(`attr_${attr}`).value);
                if (isNaN(value) || value < 0) {
                    alert((currentLang === 'he' ? '×× × ×”×–×Ÿ ×¢×¨×š ×—×•×§×™ ×¢×‘×•×¨ ' : 'Please enter a valid value for ') + t('attrs.' + attr));
                    hasError = true;
                    return;
                }
                playerStats[attr] = value;
            });

            if (hasError) return;

            showSection('recommendationsSection');
            document.getElementById('recRoleName').textContent = selectedRole;
            displayRecommendations();
        }

        function displayRecommendations() {
            const whiteAttrs = new Set(ROLE_WHITES[selectedRole]);
            const whiteDrills = [];
            const mixedDrills = [];
            const grayDrills = [];
            const ineffective = [];

            DRILLS.forEach(([name, attrs, difficulty, category]) => {
                const analysis = analyzeDrill(attrs, whiteAttrs);
                if (!analysis.overallAvg) return;

                const drill = {
                    name, attrs, difficulty, category,
                    ...analysis,
                    potential: EFFECTIVENESS_THRESHOLD - analysis.overallAvg
                };

                if (analysis.overallAvg >= EFFECTIVENESS_THRESHOLD) {
                    ineffective.push(drill);
                } else if (analysis.whiteAttrs.length > 0 && analysis.grayAttrs.length === 0) {
                    whiteDrills.push(drill);
                } else if (analysis.grayAttrs.length > 0 && analysis.whiteAttrs.length === 0) {
                    grayDrills.push(drill);
                } else {
                    mixedDrills.push(drill);
                }
            });

            whiteDrills.sort((a, b) => a.whiteAvg - b.whiteAvg);
            mixedDrills.sort((a, b) => {
                if (b.whiteAttrs.length !== a.whiteAttrs.length) {
                    return b.whiteAttrs.length - a.whiteAttrs.length;
                }
                if (a.whiteAvg !== b.whiteAvg) {
                    return a.whiteAvg - b.whiteAvg;
                }
                return b.grayAvg - a.grayAvg;
            });
            grayDrills.sort((a, b) => b.grayAvg - a.grayAvg);

            const tierBonus = PLAYER_TIERS[playerTier];
            const summaryBox = document.getElementById('summaryBox');
            summaryBox.innerHTML = `
                <h3>ğŸ“Š ${t('summary')}</h3>
                <div style="font-size: 14px; line-height: 1.8;">
                    <div><strong>${t('playerTier')}</strong> ${t('tiers.' + playerTier)} (+${tierBonus} ${t('tierIncluded')})</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">${t('tierSubtracted')}</div>
                    <div style="margin-top: 10px;"><strong>${t('effectiveDrills')}</strong> ${whiteDrills.length + mixedDrills.length + grayDrills.length}</div>
                    <div style="color: #28a745;">â–ª ${t('whiteOnly')} ${whiteDrills.length}</div>
                    <div style="color: #ffc107;">â–ª ${t('mixed')} ${mixedDrills.length}</div>
                    <div style="color: #6c757d;">â–ª ${t('grayOnly')} ${grayDrills.length}</div>
                    <div style="margin-top: 10px;"><strong>${t('ineffective')}</strong> ${ineffective.length}</div>
                </div>
                <div class="category-legend">
                    <div class="legend-item"><div class="legend-color" style="background:#dc3545;"></div> ${t('attack')}</div>
                    <div class="legend-item"><div class="legend-color" style="background:#28a745;"></div> ${t('defense')}</div>
                    <div class="legend-item"><div class="legend-color" style="background:#6f42c1;"></div> ${t('physical')}</div>
                    <div class="legend-item"><div class="legend-color" style="background:#fd7e14;"></div> ${t('possession')}</div>
                </div>
            `;

            const list = document.getElementById('recommendationsList');
            list.innerHTML = '';

            if (whiteDrills.length > 0) {
                list.innerHTML += `<div class="priority-header white">${t('priority1')}</div>`;
                whiteDrills.forEach(drill => list.appendChild(createDrillCard(drill, 'white')));
            }

            if (mixedDrills.length > 0) {
                list.innerHTML += `<div class="priority-header mixed">${t('priority2')}</div>`;
                mixedDrills.forEach(drill => list.appendChild(createDrillCard(drill, 'mixed')));
            }

            if (grayDrills.length > 0) {
                list.innerHTML += `<div class="priority-header gray">${t('priority3')}</div>`;
                grayDrills.forEach(drill => list.appendChild(createDrillCard(drill, 'gray')));
            }

            if (whiteDrills.length === 0 && mixedDrills.length === 0 && grayDrills.length === 0) {
                list.innerHTML = `<div class="no-drills">${t('noDrills')}</div>`;
            }
        }

        function analyzeDrill(drillAttrs, whiteAttrs) {
            const whiteInDrill = [];
            const grayInDrill = [];
            const whiteValues = [];
            const grayValues = [];
            const tierBonus = PLAYER_TIERS[playerTier];

            drillAttrs.forEach(attr => {
                if (!(attr in playerStats)) return;

                if (whiteAttrs.has(attr)) {
                    whiteInDrill.push(attr);
                    const baseValue = playerStats[attr] - tierBonus;
                    whiteValues.push(baseValue);
                } else {
                    grayInDrill.push(attr);
                    grayValues.push(playerStats[attr]);
                }
            });

            const whiteAvg = whiteValues.length > 0 ? whiteValues.reduce((a, b) => a + b, 0) / whiteValues.length : null;
            const grayAvg = grayValues.length > 0 ? grayValues.reduce((a, b) => a + b, 0) / grayValues.length : null;
            const allValues = [...whiteValues, ...grayValues];
            const overallAvg = allValues.length > 0 ? allValues.reduce((a, b) => a + b, 0) / allValues.length : null;

            return { whiteAttrs: whiteInDrill, grayAttrs: grayInDrill, whiteAvg, grayAvg, overallAvg };
        }

        function createDrillCard(drill, type) {
            const card = document.createElement('div');
            card.className = `drill-card ${type} category-${drill.category}`;

            let statsHtml = '';
            if (type === 'white') {
                statsHtml = `${t('whiteAvg')} ${drill.whiteAvg.toFixed(1)} | ${t('potential')} +${drill.potential.toFixed(1)}`;
            } else if (type === 'mixed') {
                const whiteStr = drill.whiteAvg ? `${t('white')} ${drill.whiteAvg.toFixed(1)}` : '';
                const grayStr = drill.grayAvg ? `${t('gray')} ${drill.grayAvg.toFixed(1)}` : '';
                statsHtml = `${whiteStr} | ${grayStr} | ${t('overall')} ${drill.overallAvg.toFixed(1)}`;
            } else {
                statsHtml = `${t('grayAvg')} ${drill.grayAvg.toFixed(1)} | ${t('overall')} ${drill.overallAvg.toFixed(1)}`;
            }

            let attrsHtml = '';
            if (type === 'white') {
                attrsHtml = `${t('trains')} ${drill.whiteAttrs.map(a => t('attrs.' + a)).join(', ')}`;
            } else if (type === 'mixed') {
                attrsHtml = `<div>${t('trains')} ${t('white')} ${drill.whiteAttrs.map(a => t('attrs.' + a)).join(', ')}</div>`;
                attrsHtml += `<div>${t('trains')} ${t('gray')} ${drill.grayAttrs.map(a => t('attrs.' + a)).join(', ')}</div>`;
            } else {
                attrsHtml = `${t('trains')} ${drill.grayAttrs.map(a => t('attrs.' + a)).join(', ')}`;
            }

            card.innerHTML = `
                <h3>
                    ${t('drills.' + drill.name)}
                    <span class="badge badge-category badge-${drill.category}">${t(drill.category)}</span>
                    <span class="badge badge-difficulty">${drill.difficulty}</span>
                </h3>
                <div class="drill-stats">${statsHtml}</div>
                <div class="drill-attrs">${attrsHtml}</div>
            `;

            return card;
        }

        function updateAttributes() {
            showSection('updateSection');
            const form = document.getElementById('updateForm');
            const attributes = selectedRole === 'GK' ? GK_ATTRIBUTES : REGULAR_ATTRIBUTES;
            const whiteAttrs = new Set(ROLE_WHITES[selectedRole]);

            form.innerHTML = '';

            const tierGroup = document.createElement('div');
            tierGroup.style.marginBottom = '20px';
            tierGroup.innerHTML = `
                <div class="form-group">
                    <label style="font-size: 16px; color: #667eea;">${t('playerTierLabel')}</label>
                    <select id="updatePlayerTier" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
                        ${Object.keys(PLAYER_TIERS).map(tier =>
                            `<option value="${tier}" ${tier === playerTier ? 'selected' : ''}>${t('tiers.' + tier)} (+${PLAYER_TIERS[tier]})</option>`
                        ).join('')}
                    </select>
                </div>
            `;
            form.appendChild(tierGroup);

            const grid = document.createElement('div');
            grid.className = 'attr-grid';

            attributes.forEach(attr => {
                const isWhite = whiteAttrs.has(attr);
                const current = playerStats[attr];
                const formGroup = document.createElement('div');
                formGroup.className = 'form-group';
                formGroup.innerHTML = `
                    <label>${t('attrs.' + attr)} ${isWhite ? 'â­' : ''} <span style="color: #999; font-size: 12px;">(${current})</span></label>
                    <input type="number" id="update_${attr}" min="0" placeholder="${currentLang === 'he' ? '×”×©××¨ ×¨×™×§ = ' + current : 'Leave blank = ' + current}">
                `;
                grid.appendChild(formGroup);
            });

            form.appendChild(grid);
        }

        function saveUpdates() {
            const attributes = selectedRole === 'GK' ? GK_ATTRIBUTES : REGULAR_ATTRIBUTES;
            let updated = false;

            const newTier = document.getElementById('updatePlayerTier').value;
            if (newTier !== playerTier) {
                playerTier = newTier;
                updated = true;
            }

            attributes.forEach(attr => {
                const input = document.getElementById(`update_${attr}`);
                const value = input.value.trim();
                if (value !== '') {
                    const num = parseInt(value);
                    if (!isNaN(num) && num >= 0) {
                        playerStats[attr] = num;
                        updated = true;
                    }
                }
            });

            if (updated) {
                showSection('recommendationsSection');
                displayRecommendations();
            } else {
                alert(currentLang === 'he' ? '×œ× ×‘×•×¦×¢×• ×©×™× ×•×™×™×. ×”×–×Ÿ ×œ×¤×—×•×ª ×¢×¨×š ×—×“×© ××—×“ ××• ×©× ×” ×“×¨×’×”.' : 'No changes made. Enter at least one new value or change tier.');
            }
        }

        function viewAttributes() {
            showSection('viewAttributesSection');
            document.getElementById('viewRoleName').textContent = selectedRole;

            const display = document.getElementById('attributesDisplay');
            const attributes = selectedRole === 'GK' ? GK_ATTRIBUTES : REGULAR_ATTRIBUTES;
            const whiteAttrs = new Set(ROLE_WHITES[selectedRole]);
            const tierBonus = PLAYER_TIERS[playerTier];

            let html = '<div class="attributes-display">';

            if (tierBonus > 0) {
                html += `<div style="background: #e7f3ff; border: 2px solid #2196F3; border-radius: 8px; padding: 12px; margin-bottom: 15px; font-size: 14px; color: #0d47a1;">
                    <strong>${t('playerTier')}</strong> ${t('tiers.' + playerTier)} (+${tierBonus} ${t('bonusIncluded')})
                </div>`;
            }

            html += `<h4>${t('whitePrimary')}</h4>`;
            attributes.forEach(attr => {
                if (whiteAttrs.has(attr)) {
                    const totalValue = playerStats[attr];
                    const baseValue = totalValue - tierBonus;
                    const bonusText = tierBonus > 0 ? ` <span style="color: #2196F3; font-size: 12px;">(${baseValue} ${t('base')} + ${tierBonus})</span>` : '';
                    html += `<div class="attr-item white"><span>${t('attrs.' + attr)}</span><strong>${totalValue}${bonusText}</strong></div>`;
                }
            });

            html += `<h4 style="margin-top: 20px;">${t('graySecondary')}</h4>`;
            attributes.forEach(attr => {
                if (!whiteAttrs.has(attr)) {
                    html += `<div class="attr-item gray"><span>${t('attrs.' + attr)}</span><strong>${playerStats[attr]}</strong></div>`;
                }
            });
            html += '</div>';

            display.innerHTML = html;
        }

        function backToRecommendations() {
            showSection('recommendationsSection');
        }

        function backToRoles() {
            showSection('roleSection');
            selectedRole = null;
            playerStats = {};
            playerTier = "None";
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('selectedRoleBox').classList.remove('show');
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        initRoleGrid();
    </script>
</body>
</html>
